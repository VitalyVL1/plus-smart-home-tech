spring:
  jpa:
    hibernate.ddl-auto: none
    properties:
      hibernate:
        jdbc.time_zone: UTC
        format_sql: true
    show-sql: true
  database-platform: org.hibernate.dialect.PostgreSQLDialect
  sql.init.mode: always
  datasource:
    url: jdbc:postgresql://localhost:5432/smarthomedb?currentSchema=commerce_cart
    driver-class-name: org.postgresql.Driver
    username: postgres
    password: 12345

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,circuitbreakers

resilience4j.circuitbreaker:
  configs:
    # Базовая конфигурация по умолчанию
    default:
      slidingWindowType: COUNT_BASED        # Анализ по количеству вызовов
      slidingWindowSize: 100                # Анализировать последние 100 вызовов
      minimumNumberOfCalls: 10              # Минимальное кол-во вызовов для принятия решения
      permittedNumberOfCallsInHalfOpenState: 3  # Тестовые вызовы в HALF_OPEN состоянии
      automaticTransitionFromOpenToHalfOpenEnabled: true  # Автопереход OPEN → HALF_OPEN
      writableStackTraceEnabled: false      # Без полных stack traces (экономия памяти)

  instances:
    # Магазин/каталог - сервис чтения, можно кешировать данные
    shopping-store:
      baseConfig: default                   # Наследуем базовые настройки
      slidingWindowType: TIME_BASED         # Временное окно для переменной нагрузки
      slidingWindowSize: 60                 # Анализировать вызовы за последние 60 секунд
      failureRateThreshold: 40              # CB срабатывает при 40% ошибок
      slowCallRateThreshold: 40             # CB срабатывает при 40% медленных вызовов
      slowCallDurationThreshold: 2000       # Вызов считается медленным если > 2 сек
      waitDurationInOpenState: 10000        # 10 секунд в OPEN состоянии

    # Склад - критичный для бизнеса, но может быть медленным
    warehouse:
      baseConfig: default                   # Наследуем базовые настройки
      slidingWindowSize: 30                 # Анализировать только последние 30 вызовов
      minimumNumberOfCalls: 5               # Всего 5 вызовов достаточно для анализа
      failureRateThreshold: 20              # CB срабатывает при 20% ошибок
      slowCallRateThreshold: 25             # CB срабатывает при 25% медленных вызовов
      slowCallDurationThreshold: 1000       # Вызов считается медленным если > 1 сек
      waitDurationInOpenState: 30000        # 30 секунд в OPEN состоянии (дольше для восстановления)