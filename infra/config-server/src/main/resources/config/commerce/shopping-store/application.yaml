spring:
  jpa:
    hibernate.ddl-auto: none
    properties:
      hibernate:
        jdbc.time_zone: UTC
        format_sql: true
    show-sql: true
  database-platform: org.hibernate.dialect.PostgreSQLDialect
  sql.init.mode: always
  datasource:
    url: jdbc:postgresql://localhost:5432/smarthomedb?currentSchema=commerce_store
    driver-class-name: org.postgresql.Driver
    username: postgres
    password: 12345

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,circuitbreakers

resilience4j.circuitbreaker:
  configs:
    # Базовая конфигурация по умолчанию
    default:
      slidingWindowType: COUNT_BASED        # Анализ по количеству вызовов
      slidingWindowSize: 100                # Анализировать последние 100 вызовов
      minimumNumberOfCalls: 10              # Минимальное кол-во вызовов для принятия решения
      permittedNumberOfCallsInHalfOpenState: 3  # Тестовые вызовы в HALF_OPEN состоянии
      automaticTransitionFromOpenToHalfOpenEnabled: true  # Автопереход OPEN → HALF_OPEN
      writableStackTraceEnabled: false      # Без полных stack traces (экономия памяти)

  instances:
    # Склад - критичный для бизнеса, но может быть медленным
    warehouse:
      baseConfig: default                   # Наследуем базовые настройки
      slidingWindowSize: 30                 # Анализировать только последние 30 вызовов
      minimumNumberOfCalls: 5               # Всего 5 вызовов достаточно для анализа
      failureRateThreshold: 20              # CB срабатывает при 20% ошибок
      slowCallRateThreshold: 25             # CB срабатывает при 25% медленных вызовов
      slowCallDurationThreshold: 1000       # Вызов считается медленным если > 1 сек
      waitDurationInOpenState: 30000        # 30 секунд в OPEN состоянии (дольше для восстановления)

    # Корзина товаров - нужен быстрый доступ к данным
    shopping-cart:
      baseConfig: default                   # Наследуем настройки из default
      minimumNumberOfCalls: 20              # Больше вызовов для анализа (стабильность)
      failureRateThreshold: 20              # CB срабатывает при 20% ошибок
      slowCallRateThreshold: 25             # CB срабатывает при 25% медленных вызовов
      slowCallDurationThreshold: 1000       # Вызов считается медленным если > 1 сек
      waitDurationInOpenState: 5000         # 5 секунд в OPEN состоянии